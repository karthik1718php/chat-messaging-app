<!DOCTYPE html>
<html>

<head>
  <title>Chat Room</title>
  <script src="/socket.io/socket.io.js"></script>
</head>

<body>
  <h2>Join Chat Room</h2>
  <input id="username" value="" placeholder="Enter your name" />
  <input id="room" placeholder="Enter room name" />
  <button onclick="joinRoom()">Join</button>

  <div id="chatBox" style="margin-top:20px; display:none;">
    <div id="messages" style="border:1px solid #ccc; height:200px; overflow-y:scroll;"></div>
    <input id="messageInput" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    const socket = io();
    let roomName = "";
    let userName = "";

    function joinRoom() {
      userName = document.getElementById("username").value;
      roomName = "68a5c0902ff333c0070024d2";
      // roomName = document.getElementById("room").value;
      socket.emit("joinRoom", roomName, userName);
      document.getElementById("chatBox").style.display = "block";
    }

    socket.on("joinRoom", (data) => {
      console.log(data.message);
      const li = document.createElement("li");
      li.textContent = data.message;
      li.style.fontStyle = "italic";
      li.style.color = "green";
      document.getElementById("messages").appendChild(li);
    });

    function sendMessage() {
      const text = document.getElementById("messageInput").value;
      socket.emit("chatMessage", { roomName, user: userName, text });
      document.getElementById("messageInput").value = "";
    }

    socket.on("chatMessage", (data) => {
      const msgBox = document.getElementById("messages");
      msgBox.innerHTML += `<p><strong>${data.user}:</strong> ${data.text}</p>`;
      msgBox.scrollTop = msgBox.scrollHeight;
    });

    const userId = "68a30079981cdcca657c71f3"; // Example logged-in user

    // Tell server this user is online
    socket.emit("joinApp", { userId });

    // Listen for user status changes
    socket.on("userStatus", ({ userId, status }) => {
      console.log(`ðŸ“¢ User ${userId} is now ${status}`);
      const el = document.getElementById(userId);
      if (el) el.innerText = status === "online" ? "ðŸŸ¢ Online" : "âšª Offline";
    });
  </script>
</body>

</html>